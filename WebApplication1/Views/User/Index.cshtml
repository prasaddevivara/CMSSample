@model IEnumerable<CMSSample.DomainModel.ViewModels.UserDisplayViewModel>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<p>
    @Html.ActionLink("Create New", "Create")
</p>

<h2>Users</h2>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.UserName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.FirstName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.LastName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Email)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Mobile)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.RoleName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.DZName)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
<tr>
    <td>
        @Html.DisplayFor(modelItem => item.UserName)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.FirstName)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.LastName)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.Email)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.Mobile)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.RoleName)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.DZName)
    </td>
    <td>
        @Html.ActionLink("Edit", "Edit", "User", new { id = item.UserId }, null) |
        <a onclick="DeleteUser(@item.UserId)" href="">Delete</a>
    </td>
</tr>
}

</table>

<script type="text/javascript">

    function DeleteUser(id) {         
        if (confirm("Are you sure to delete User?")) {
            $.ajax({
                type: "POST", 
                url: 'http://localhost/CMSSample.WebApp/User/Delete',  
                async: false,                                            
                data: JSON.stringify({ 'Id': id }),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    if (data.status == "Success") {
                        alert(data.message);
                        return true;
                    } else {
                        alert("Error occurs on the Database level!");
                        return false;
                    }
                },
                error: function () {
                    alert("An error has occured!!!");
                    return false;
                }
            });
        }
        else {
            return false;
        }
            
    }
</script>